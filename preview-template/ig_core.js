!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ig={})}(this,(function(t){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])}return n},writable:!0,configurable:!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var i=e[o];if(t.call(r,i,o,e))return o;o++}return-1}}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(t){if(null==this)throw new TypeError("this is null or not defined");for(var e=Object(this),n=e.length>>>0,r=arguments[1],o=r>>0,i=o<0?Math.max(n+o,0):Math.min(o,n),s=arguments[2],a=void 0===s?n:s>>0,c=a<0?Math.max(n+a,0):Math.min(a,n);i<c;)e[i]=t,i++;return e}}),Int32Array.prototype.fill||(Int32Array.prototype.fill=Array.prototype.fill),Float32Array.prototype.map||(Float32Array.prototype.map=Array.prototype.map),void 0===Number.isFinite&&(Number.isFinite=function(t){return"number"==typeof t&&isFinite(t)}),Date.now=Date.now||function(){return(new Date).getTime()},Promise.retry=function(t,e,n){return void 0===e&&(e=2),void 0===n&&(n=1e3),new Promise((function(r,o){!function i(){t().then((function(t){return r(t)})).catch((function(t){0!=--e?setTimeout((function(){return i()}),n):o(new Error("reject: too many failed attempts: "+t))})).catch(o)}()}))},Promise.wait=function(t){return new Promise((function(e){return window.setTimeout(e,t)}))},String.prototype.substitute=function(t){return this.replace(/\{(.+?)\}/gi,(function(e,n){return t[n]}))},Object.defineProperty(Array.prototype,"random",{value:function(t){if(0==this.length)return null;var e=Math.floor(this.length*Math.random()),n=this[e];return t&&this.splice(e,1),n},configurable:!0,writable:!0}),Object.defineProperty(Array.prototype,"choice",{value:function(t){if(0==this.length)return null;null==t&&(t=function(t){return t});for(var e=this.reduce((function(e,n,r){return e+t(n,r)}),0)*Math.random(),n=this.length,r=0;r<n;r++){var o=t(this[r],r);if(e<o)return this[r];e-=o}return this[n-1]},configurable:!0,writable:!0}),Object.defineProperty(Array.prototype,"unique",{value:function(){for(var t=[],e=0;e<this.length;)t.indexOf(this[e])>=0?this.splice(e,1):t.push(this[e++]);return this},configurable:!0,writable:!0}),Object.defineProperty(Array.prototype,"sorton",{value:function(t,e){return void 0===e&&(e=!0),"string"==typeof t&&(t=[t]),this.sort((function(n,r){for(var o=0,i=0,s=t.length,a=0;a<s;a++){var c=t[a];o+=(n[c]||0)/1e5*(s-a),i+=(r[c]||0)/1e5*(s-a)}var u=o-i;return e||(u*=-1),u}))},configurable:!0,writable:!0}),Object.defineProperty(Array.prototype,"rm",{value:function(t){for(var e="function"==typeof t?t:function(e){return e==t},n=0;n<this.length;){if(e(this[n]))return this.splice(n,1),this;n++}return this},configurable:!0,writable:!0}),Object.defineProperty(Array.prototype,"shuffle",{value:function(){for(var t,e=this.length-1;e>0;e--){var n=Math.floor(Math.random()*(e+1));t=[this[n],this[e]],this[e]=t[0],this[n]=t[1]}return this},configurable:!0,writable:!0}),Object.defineProperty(Array.prototype,"binary_search",{value:function(t,e,n){void 0===n&&(n=0);for(var r=n,o=this.length-1,i=0,s=0,a=(e=e||function(t){return t})(t);r<=o;)if((s=e(this[i=r+o>>>1])-a)<0)r=i+1;else{if(!(s>0))return i;o=i-1}return~r},configurable:!0,writable:!0}),Object.defineProperty(Array.prototype,"binary_insert",{value:function(t,e,n){void 0===e&&(e=!1);var r=this.binary_search(t,n);if(r>=0){if(!e)return r}else r=~r;return this.splice(r,0,t),r},configurable:!0,writable:!0}),Object.defineProperty(window,"waitAsync",{value:function(t,e){return new Promise((function(n,r){var o=0;o=window.setTimeout((function(){window.clearTimeout(o),n(),e&&e()}),t)}))},configurable:!0,writable:!0}),Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t},Date.week=function(t){void 0===t&&(t=2521);return~~((Date.now()+-252e5+864e5)/6048e5)-t-1},Date.days=function(t){void 0===t&&(t=0);return~~((Date.now()+-252e5+864e5)/864e5)-t-1},Math.rad=function(t){return t*Math.PI/180},Math.deg=function(t){return 180*t/Math.PI},Math.normalDeg=function(t){return(t%=360)<0&&(t+=360),t},Math.randInt=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=10),Math.floor(Math.random()*(e-t+1))+t},Math.randFloat=function(t,e){var n=Math.randInt(0,1e3);return Math.lerp(t,e,n/1e3)},Math.clamp=function(t,e,n){return Math.max(e,Math.min(t,n))},Math.lerp=function(t,e,n){return t+(e-t)*n},Math.towards=function(t,e,n){var r=t<e?1:-1;n=Math.abs(n);var o=Math.abs(e-t);return o<n&&(n=o),t+n*r},Math.udid=function(){var t=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)}))},function(){var t=0,e=987654321,n=4294967295;function r(){var r=((e=36969*(65535&e)+(e>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return(r/=4294967296)+.5}var o=Math.random;Object.defineProperty(Math,"randomSeed",{get:function(){return t},set:function(e){+e?(t=e,Math.random=r):(t=0,Math.random=o)},enumerable:!0,configurable:!0})}();
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,n)};function n(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function r(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))}function o(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function i(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t}var s,a=function(){function t(){this.maps={},this.uid=0,this._duringEmit=!1}return t.prototype.add=function(t,e,n,r,o){n=n||null,r=r||0;var i=this.uid++,s=this.maps[t]||[];return s.push([i,e,n,r,o]),this.maps[t]=s,s.sort((function(t,e){return e[3]-t[3]})),i},t.prototype.on=function(t,e,n,r){return this.add(t,e,n,r,!1)},t.prototype.once=function(t,e,n,r){return this.add(t,e,n,r,!0)},t.prototype.race=function(t,e,n,r){for(var o=this,s=[],a=!1,c=function(t){if(a)return"break";s.push([u.once(t,(function(){return function(t){for(var r=[],c=1;c<arguments.length;c++)r[c-1]=arguments[c];a=!0,s.forEach((function(t){return o.rm(t[0],t[1])})),e.apply(n,i([t],r))}(t)}),n,r),t])},u=this,l=0,h=t;l<h.length;l++){if("break"===c(h[l]))break}},t.prototype.rm=function(t,e){for(var n=0,r=e?[e]:Object.keys(this.maps);n<r.length;n++){var o=r[n],i=this.maps[o];if(i){this._duringEmit&&(this.maps[o]=i=i.concat());for(var s=0;s<i.length;){var a=i[s],c=a[0];if(a[1],a[2],a[3],a[4],c==t)return i.splice(s,1),!0;s++}}}return!1},t.prototype.rmall=function(t){null==t?this.maps={}:delete this.maps[t]},t.prototype.emit=function(e,n){var r=this.maps[e];if(r&&r.length>0){for(var o=0;o<r.length;){var i=r[o];i[0];var s=i[1],a=i[2];i[3],i[4]?r.splice(o,1):o++,this._duringEmit=!0;var c=s.call(a,n);if(this._duringEmit=!1,c==t.CONST.break)break}return!0}return!1},t.CONST={break:{}},t.center=new t,t}(),c=function(){function t(t){this.create=t,this._arr=[]}return t.prototype.get=function(){return this._arr.length>0?this._arr.pop():this.create()},t.prototype.put=function(t){this._arr.push(t)},t}(),u=function(){function t(){this._commands={},this._responders=[],t.inst=this,this.emiter=new a}return t.prototype.registCommand=function(t,e){if(this._commands[t])throw"cmd has been registed already!!!";var n=this.emiter.on(t,(function(n){(new e).excute(n,t)}));this._commands[t]=n},t.prototype.unregistCommand=function(t){var e=this._commands[t];e&&this.emiter.rm(e,t)},t.prototype.registResponser=function(t){if(this._responders.some((function(e){return e.res==t})))throw"this responser has been registed already!";for(var e=t.listResponse(),n=[],r=function(e){var r=o.emiter.on(e,(function(n){t.doResponse(e,n)}));n.push({name:e,id:r})},o=this,i=0,s=e;i<s.length;i++){r(s[i])}this._responders.push({res:t,ids:n})},t.prototype.unregistResponser=function(t){for(var e=0,n=this._responders;e<n.length;e++){var r=n[e];if(r.res==t){for(var o=0,i=r.ids;o<i.length;o++){var s=i[o];this.emiter.rm(s.id,s.name)}this._responders.splice(this._responders.indexOf(r),1);break}}},t.prototype.notify=function(t,e){return this.emiter.emit(t,e)},t.prototype.dispose=function(){this.emiter.rmall(),this._responders.length=0},t}(),l=function(){function t(){}return t.prototype.notify=function(t,e){return u.inst.notify(t,e)},t}(),h=function(){function t(){}return t.getInst=function(){return s||(s=new t)},t.prototype.encodeValue=function(t,e){return e instanceof Array?this.encodeArray(t,e):encodeURIComponent(t)+"="+encodeURIComponent(e)},t.prototype.encodeArray=function(t,e){return t?0==e.length?encodeURIComponent(t)+"=":e.map((function(e){return encodeURIComponent(t)+"="+encodeURIComponent(e)})).join("&"):""},t.prototype.toString=function(t){if(!t)return"";var e=[];for(var n in t)e.push(this.encodeValue(n,t[n]));return e.join("&")},t.prototype.request=function(t){var e=new XMLHttpRequest;e.responseType="arraybuffer"!==t.responseType?"text":"arraybuffer",e.timeout=t.timeout||0,e.onerror=function(n){console.log("[http]["+t.method+"][error] ["+e.status+":"+e.statusText+"] "+t.url),t.onerror&&t.onerror(n)},e.onabort=function(e){console.log("[http]["+t.method+"][abort] "+t.url),t.onabort&&t.onabort()},e.onprogress=function(e){e&&e.lengthComputable&&t.onprogress&&t.onprogress(e.loaded/e.total)},e.onload=function(n){var r=void 0!==e.status?e.status:200;if(200===r||204===r||0===r){var o=e.response||e.responseText;console.log("[http]["+t.method+"][loaded] "+t.url+":"+o),t.onload(o)}else console.log("[http]["+t.method+"][error] ["+e.status+":"+e.statusText+"] "+t.url),t.onerror&&t.onerror(n)};var n=this.toString(t.data),r=t.url;if("GET"==t.method&&n&&(r=t.url+"?"+n,n=null),e.open(t.method,r,!0),"POST"==t.method&&(t.rawData?(e.setRequestHeader("Content-Type","application/json"),n=JSON.stringify(t.rawData)):e.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),t.headers)for(var o=0;o<t.headers.length;o++)e.setRequestHeader(t.headers[o++],t.headers[o]);return e.send(n),console.log("[http]["+t.method+"] "+t.url+":"+JSON.stringify(t.data)),e},t.prototype.post=function(t,e){var n=this;return new Promise((function(r,o){n.request({url:t,data:e,method:"POST",onload:r,onerror:o,ontimeout:o})}))},t.prototype.get=function(t,e){var n=this;return new Promise((function(r,o){n.request({url:t,data:e,method:"GET",onload:r,onerror:o,ontimeout:o})}))},t}(),f=function(){function t(t){void 0===t&&(t="g"),this.id=t}return t.prototype.set=function(t,e){"object"==typeof e&&(e=JSON.stringify(e)),localStorage.setItem(this.id+"_"+t,e)},t.prototype.get=function(t,e){return localStorage.getItem(this.id+"_"+t)||e},t.prototype.rm=function(t){localStorage.removeItem(this.id+"_"+t)},t.prototype.json=function(t,e){void 0===e&&(e=null);var n,r=localStorage.getItem(this.id+"_"+t);try{n=JSON.parse(r)}catch(t){}return n||e},t.clear=function(){localStorage.clear()},t}();t.Utils=void 0,(t.Utils||(t.Utils={})).wait=function(t){return new Promise((function(e){return setTimeout(e,t)}))};var p=function(){function t(){this._stateMap_=null,this._currentState_=null,this._nxtState_=null,this.pause_=!1}return t.prototype.mount_=function(){this._stateMap_={},this._currentState_=null,this._nxtState_=null,this.pause_=!1,this.onInit_(),this.onRegister_()},t.prototype.unmount_=function(){this._stateMap_=null,this._currentState_&&this._currentState_.clear_(),this._currentState_=null,this._nxtState_=null,this.pause_=!0},t.prototype.update_=function(t){this.pause_||(this._nxtState_&&(this._currentState_&&this._currentState_.exit_(),this._currentState_=this._nxtState_,this._nxtState_=null,this._currentState_.enter_()),this._currentState_&&this._currentState_.update_(t))},t.prototype.onRegister_=function(){},t.prototype.onInit_=function(){},t.prototype.registerState_=function(t){var e=t.name_;this._stateMap_[e]=t},t.prototype.forceSetState_=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this._nxtState_=this._stateMap_[t],this._nxtState_&&this._nxtState_.init_.apply(this._nxtState_,e)},t.prototype.setState_=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this._stateMap_[t];r&&(this._currentState_&&r.name_==this._currentState_.name_||this._nxtState_&&r.name_==this._nxtState_.name_||this.forceSetState_.apply(this,i([t],e)))},t.prototype.isState_=function(t){var e=this._currentState_&&this._currentState_.name_;return(this._nxtState_&&this._nxtState_.name_)==t||e==t},t.prototype.getState_=function(t){return this._stateMap_[t]||null},t}(),d=function(){function t(t,e){this.owner=null,this.name_="",this.owner=e,this.name_=t}return t.prototype.init_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.enter_=function(){},t.prototype.update_=function(t){},t.prototype.exit_=function(){},t.prototype.clear_=function(){},t}(),y=function(){function t(){this._list=[],this._duringUpdate=!1}return t.prototype.add=function(t){this._list.indexOf(t)>-1||this._list.push(t)},t.prototype.rm=function(t){var e=this._list.indexOf(t);-1!=e&&(this._duringUpdate&&(this._list=this._list.concat()),this._list.splice(e,1))},t.prototype.update=function(t){var e=this._list;this._duringUpdate=!0;for(var n=0,r=e;n<r.length;n++){r[n].onUpdate(t)}this._duringUpdate=!1},t}();t.LZString=void 0,function(t){var e=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function i(t,e){if(!o[t]){o[t]={};for(var n=0;n<t.length;n++)o[t][t.charAt(n)]=n}return o[t][e]}function s(t){return a(t,16,(function(t){return e(t)}))}function a(t,e,n){if(null==t)return"";var r,o,i,s={},a={},c="",u="",l="",h=2,f=3,p=2,d=[],y=0,m=0;for(i=0;i<t.length;i+=1)if(c=t.charAt(i),Object.prototype.hasOwnProperty.call(s,c)||(s[c]=f++,a[c]=!0),u=l+c,Object.prototype.hasOwnProperty.call(s,u))l=u;else{if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(r=0;r<p;r++)y<<=1,m==e-1?(m=0,d.push(n(y)),y=0):m++;for(o=l.charCodeAt(0),r=0;r<8;r++)y=y<<1|1&o,m==e-1?(m=0,d.push(n(y)),y=0):m++,o>>=1}else{for(o=1,r=0;r<p;r++)y=y<<1|o,m==e-1?(m=0,d.push(n(y)),y=0):m++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)y=y<<1|1&o,m==e-1?(m=0,d.push(n(y)),y=0):m++,o>>=1}0==--h&&(h=Math.pow(2,p),p++),delete a[l]}else for(o=s[l],r=0;r<p;r++)y=y<<1|1&o,m==e-1?(m=0,d.push(n(y)),y=0):m++,o>>=1;0==--h&&(h=Math.pow(2,p),p++),s[u]=f++,l=String(c)}if(""!==l){if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(r=0;r<p;r++)y<<=1,m==e-1?(m=0,d.push(n(y)),y=0):m++;for(o=l.charCodeAt(0),r=0;r<8;r++)y=y<<1|1&o,m==e-1?(m=0,d.push(n(y)),y=0):m++,o>>=1}else{for(o=1,r=0;r<p;r++)y=y<<1|o,m==e-1?(m=0,d.push(n(y)),y=0):m++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)y=y<<1|1&o,m==e-1?(m=0,d.push(n(y)),y=0):m++,o>>=1}0==--h&&(h=Math.pow(2,p),p++),delete a[l]}else for(o=s[l],r=0;r<p;r++)y=y<<1|1&o,m==e-1?(m=0,d.push(n(y)),y=0):m++,o>>=1;0==--h&&(h=Math.pow(2,p),p++)}for(o=2,r=0;r<p;r++)y=y<<1|1&o,m==e-1?(m=0,d.push(n(y)),y=0):m++,o>>=1;for(;;){if(y<<=1,m==e-1){d.push(n(y));break}m++}return d.join("")}function c(t){return null==t?"":""==t?null:u(t.length,32768,(function(e){return t.charCodeAt(e)}))}function u(t,n,r){var o,i,s,a,c,u,l,h=[],f=4,p=4,d=3,y="",m=[],g={val:r(0),position:n,index:1};for(o=0;o<3;o+=1)h[o]=o;for(s=0,c=Math.pow(2,2),u=1;u!=c;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*u,u<<=1;switch(s){case 0:for(s=0,c=Math.pow(2,8),u=1;u!=c;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*u,u<<=1;l=e(s);break;case 1:for(s=0,c=Math.pow(2,16),u=1;u!=c;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*u,u<<=1;l=e(s);break;case 2:return""}for(h[3]=l,i=l,m.push(l);;){if(g.index>t)return"";for(s=0,c=Math.pow(2,d),u=1;u!=c;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*u,u<<=1;switch(l=s){case 0:for(s=0,c=Math.pow(2,8),u=1;u!=c;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*u,u<<=1;h[p++]=e(s),l=p-1,f--;break;case 1:for(s=0,c=Math.pow(2,16),u=1;u!=c;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*u,u<<=1;h[p++]=e(s),l=p-1,f--;break;case 2:return m.join("")}if(0==f&&(f=Math.pow(2,d),d++),h[l])y=h[l];else{if(l!==p)return null;y=i+i.charAt(0)}m.push(y),h[p++]=i+y.charAt(0),i=y,0==--f&&(f=Math.pow(2,d),d++)}}t.compressToBase64=function(t){if(null==t)return"";var e=a(t,6,(function(t){return n.charAt(t)}));switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},t.decompressFromBase64=function(t){return null==t?"":""==t?null:u(t.length,32,(function(e){return i(n,t.charAt(e))}))},t.compressToUTF16=function(t){return null==t?"":a(t,15,(function(t){return e(t+32)}))+" "},t.decompressFromUTF16=function(t){return null==t?"":""==t?null:u(t.length,16384,(function(e){return t.charCodeAt(e)-32}))},t.compressToUint8Array=function(t){for(var e=s(t),n=new Uint8Array(2*e.length),r=0,o=e.length;r<o;r++){var i=e.charCodeAt(r);n[2*r]=i>>>8,n[2*r+1]=i%256}return n},t.decompressFromUint8Array=function(t){if(null==t)return c(t);for(var n=new Array(t.length/2),r=0,o=n.length;r<o;r++)n[r]=256*t[2*r]+t[2*r+1];var i=[];return n.forEach((function(t){i.push(e(t))})),c(i.join(""))},t.compressToEncodedURIComponent=function(t){return null==t?"":a(t,6,(function(t){return r.charAt(t)}))},t.decompressFromEncodedURIComponent=function(t){return null==t?"":""==t?null:u((t=t.replace(/ /g,"+")).length,32,(function(e){return i(r,t.charAt(e))}))},t.compress=s,t.decompress=c}(t.LZString||(t.LZString={}));var m,g=function(){function t(t,e,n,r){void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),this.r=t,this.g=e,this.b=n,this.a=r}return t.prototype.setHex=function(t){return t=Math.floor(t),this.a=(t>>24&255)/255,this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},t.prototype.getHex=function(){return(255*this.a<<24^255*this.r<<16^255*this.g<<8^255*this.b<<0)>>>0},t.prototype.getHexString=function(){return"#"+("00000000"+this.getHex().toString(16)).slice(-8)},t.prototype.getRGBHexString=function(){return"#"+("000000"+this.getHex().toString(16)).slice(-6)},t.Lerp=function(e,n,r){var o=e.a+(n.a-e.a)*r;return new t(e.r+(n.r-e.r)*r,e.g+(n.g-e.g)*r,e.b+(n.b-e.b)*r,o)},t.white=new t(1,1,1),t.black=new t(0,0,0),t.red=new t(1,0,0),t}(),_=function(){function t(){this._flagValue=0}return t.prototype.set=function(t,e){e?this._flagValue|=t:this._flagValue&=~t},t.prototype.get=function(t){return 0!=(this._flagValue&t)},t}(),v=function(){function e(e,n,r){var o=JSON.parse(t.LZString.decompressFromBase64(e)),i=JSON.parse(t.LZString.decompressFromBase64(n)),s=o.indexOf(r);this._rows=[],this._map={};for(var a=0;a<i.length;a++){for(var c={},u=0;u<o.length;u++)c[o[u]]=i[a][u];this._rows.push(c),this._map[i[a][s]]=c}}return e.prototype.get=function(t){return this._map[t]},e.prototype.getall=function(){return this._rows},e}(),I=function(){function t(t){this.creatorId="",this.creatorName="",this.creatorHead="",this.payload=null,this.contextId=t.contextId,this.endTime=t.endTime,this.createTime=this.endTime-172800,this.endTimeMS=1e3*this.endTime,this.createTimeMS=1e3*this.createTime}return Object.defineProperty(t.prototype,"isExpired",{get:function(){return Date.now()-this.endTimeMS>0},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"contextId:"+this.contextId+";    isExpired:"+this.isExpired+"\tendTime:"+this.endTime+";\tcreateTime:"+this.createTime},Object.defineProperty(t.prototype,"remainSecs",{get:function(){return Math.floor((this.endTimeMS-Date.now())/1e3)},enumerable:!1,configurable:!0}),t.fromMSG=function(e){var n=new t({contextId:e.ctx,endTime:e.et});n.creatorId=e.cid,n.creatorName=e.cn,n.creatorHead=e.cp;try{n.payload=JSON.parse(e.pld||null)||null}catch(t){console.log("payload error")}return n},t}(),w=function(){function t(){this.id="",this.name="",this.photo=""}return t.fromFBPlayer=function(e){var n=new t;return n.name=e.getName(),n.id=e.getID(),n.photo=e.getPhoto(),n},t}(),b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.score=0,e.rank=0,e.extraData=null,e}return n(e,t),Object.defineProperty(e.prototype,"skin",{get:function(){return this.extraData&&this.extraData.skin||0},enumerable:!1,configurable:!0}),e.fromLeaderBoardEntry=function(t){var n=t.getPlayer(),r=new e;r.name=n.getName(),r.id=n.getID(),r.photo=n.getPhoto(),r.score=t.getScore(),r.rank=t.getRank();var o=t.getExtraData();try{var i=JSON.parse(o);r.extraData=i}catch(t){}return r},e.fromPlayer=function(t){var n=new e;return n.name=t.name,n.id=t.id,n.photo=t.photo,n},e.toObj=function(t){return{id:t.id,name:t.name,photo:t.photo,score:t.score,rank:t.rank,extraData:t.extraData}},e.fromObj=function(t){var n=new e;return n.id=t.idp,n.name=t.name,n.photo=t.photo,n.score=t.score,n.rank=t.rank,n.extraData=t.extraData,n},e.prototype.toJSONObj=function(){return{id:this.id,score:this.score,extraData:this.extraData}},e.fromJSONObj=function(t){var n=new e;if(n.id=t.id,n.score=t.score,"string"==typeof t.extraData)try{n.extraData=JSON.parse(t.extraData)}catch(t){}else n.extraData=t.extraData;return n},e}(w),A=function(){function t(t,e){this.pl_host=t,this.game_id=e,this.platform="instant",this.game="web",this._initialized=!1,this.localDB=new f("selfrank_"+FBInstant.player.getID()),this.localData=this.localDB.json("data")}return t.prototype.setFriends=function(t){this.friends=t},t.prototype.initializeAsync=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i;return o(this,(function(s){switch(s.label){case 0:if(this._initialized)return[2];s.label=1;case 1:return s.trys.push([1,7,,8]),this.friends?[3,3]:(t=this,[4,FBInstant.player.getConnectedPlayersAsync()]);case 2:t.friends=s.sent(),s.label=3;case 3:e=2,n=function(){var t,e,n;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,r.fetchRank()];case 1:return t=o.sent(),r._weeklyEntries=t.frindEntries,r._allTimeEntries=t.worldEntries,r._weeklyEntries.forEach((function(t,e){return t.rank=e+1})),r._allTimeEntries.forEach((function(t,e){return t.rank=e+1})),e=FBInstant.player.getID(),r._weeklyEntry=r._weeklyEntries.find((function(t){return t.id==e})),r._allTimeEntry=r._allTimeEntries.find((function(t){return t.id==e})),[2,"break"];case 2:return n=o.sent(),console.log("fetch rank error",n),[3,3];case 3:return[2]}}))},r=this,s.label=4;case 4:return e-- >0?[5,n()]:[3,6];case 5:return"break"===s.sent()?[3,6]:[3,4];case 6:return this._initialized=!0,[3,8];case 7:return i=s.sent(),console.log("leaderboad initlialize failed:",i),[3,8];case 8:return[2]}}))}))},t.prototype.fetchRank=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i,s,a,c,u,l,f,p,d,y;return o(this,(function(o){switch(o.label){case 0:return 48e4,this.localData&&Date.now()-this.localData.timestamp<48e4?(console.log("use cache"),console.log(this.localData),t=this.localData.result,[3,5]):[3,1];case 1:e=this.pl_host+"/fbapi/v0/get_rankInfo_"+this.game_id,n=this.friends.map((function(t){return t.getID()})),r=FBInstant.player.getID(),n.push(r),i={game_id:this.game_id,platform:this.platform,game:this.game,playerId:r,token:this._token,type:["Instant_games_rankInfo_all","Instant_games_rankInfo_week"],players:n},o.label=2;case 2:return o.trys.push([2,4,,5]),a=(s=JSON).parse,[4,h.getInst().post(e,i)];case 3:if(0!=(t=a.apply(s,[o.sent()])).error)throw"getRankInfo failed";return this.localData={timestamp:Date.now(),result:t},this.localDB.set("data",this.localData),[3,5];case 4:return o.sent(),console.log("rank load failed"),t=this.localData?this.localData.result:{data:{}},[3,5];case 5:for(d in c=t.data.Instant_games_rankInfo_week||{},u=t.data.Instant_games_rankInfo_all||{},l={},this.friends.forEach((function(t){return l[t.getID()]=t})),l[FBInstant.player.getID()]=FBInstant.player,f=Object.keys(c).map((function(t){var e=JSON.parse(c[t]);e.id=t;var n=b.fromJSONObj(e),r=l[e.id];return r&&(n.name=r.getName(),n.photo=r.getPhoto(),delete l[e.id]),n})).sorton("score",!1),l)y=l[d],f.push(b.fromPlayer(w.fromFBPlayer(y)));for(d in l={},this.friends.forEach((function(t){return l[t.getID()]=t})),l[FBInstant.player.getID()]=FBInstant.player,p=Object.keys(u).map((function(t){var e=JSON.parse(u[t]);e.id=t;var n=b.fromJSONObj(e),r=l[e.id];return r&&(n.name=r.getName(),n.photo=r.getPhoto(),delete l[e.id]),n})).sorton("score",!1),l)y=l[d],p.push(b.fromPlayer(w.fromFBPlayer(y)));return[2,{frindEntries:f,worldEntries:p}]}}))}))},t.prototype.setScoreAsync=function(t,e){return r(this,void 0,void 0,(function(){var n,r,i,s,a,c,u,l;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n=!1,r=[],t>this.getAllTimeHighScore()&&(r.push("Instant_games_rankInfo_all"),this._allTimeEntry||(this._allTimeEntry=b.fromPlayer(w.fromFBPlayer(FBInstant.player))),this._allTimeEntry.score=t,this._allTimeEntry.extraData=e,this._allTimeEntries&&this._allTimeEntries.sorton("score",!1),this.localData&&((i=this.localData.result.data.Instant_games_rankInfo_all||{})[this._allTimeEntry.id]=JSON.stringify(this._allTimeEntry.toJSONObj()),this.localData.result.data.Instant_games_rankInfo_all=i,n=!0)),t>this.getWeeklyHighScore()&&(r.push("Instant_games_rankInfo_week"),this._weeklyEntry||(this._weeklyEntry=b.fromPlayer(w.fromFBPlayer(FBInstant.player))),this._weeklyEntry.score=t,this._weeklyEntry.extraData=e,this._weeklyEntries&&this._weeklyEntries.sorton("score",!1),this.localData&&((s=this.localData.result.data.Instant_games_rankInfo_week||{})[this._weeklyEntry.id]=JSON.stringify(this._weeklyEntry.toJSONObj()),this.localData.result.data.Instant_games_rankInfo_week=s,n=!0)),n&&this.localDB.set("data",JSON.stringify(this.localData)),0==r.length?[2]:(a=this.pl_host+"/fbapi/v0/update_rankInfo_"+this.game_id,c={game_id:this.game_id,platform:this.platform,game:this.game,token:this._token,playerId:FBInstant.player.getID(),type:r,rankInfo:JSON.stringify({score:t,extraData:e})},l=(u=JSON).parse,[4,h.getInst().post(a,c)]);case 1:if(0!=l.apply(u,[o.sent()]).error)throw"update_rankInfo error";return[3,3];case 2:return o.sent(),console.log("set core error"),[3,3];case 3:return[2]}}))}))},t.prototype.getAllTimeEntriesAsync=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.initializeAsync()];case 1:return t.sent(),[2,this._allTimeEntries||i(i([],this.friends),[FBInstant.player]).map((function(t){return b.fromPlayer(w.fromFBPlayer(t))}))]}}))}))},t.prototype.getAllTimeEntries=function(){return this._allTimeEntries||[]},t.prototype.getWeeklyEntriesAsync=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.initializeAsync()];case 1:return t.sent(),[2,this._weeklyEntries||i(i([],this.friends),[FBInstant.player]).map((function(t){return b.fromPlayer(w.fromFBPlayer(t))}))]}}))}))},t.prototype.getWeeklyEntries=function(){return this._weeklyEntries||[]},t.prototype.getAllTimeHighScore=function(){return this._allTimeEntry?this._allTimeEntry.score:0},t.prototype.getWeeklyHighScore=function(){return this._weeklyEntry?this._weeklyEntry.score:0},t}(),x=function(){this.isDirty=!1,this.context_ids=[],this.iap_inventory=[],this.created_day_index=Date.days(),this.created_tsp=Date.now(),this.login_day_index=0,this.login_day_count=0,this.gift_count=0,this.gift_time=Date.now(),this.tounament_created_tsp=0,this.tournament_solo_play_prompt=0,this.extraData={}},D=function(){this.isDirty=!1,this.tournament_map={}};t.PlatformConstant=void 0,((m=t.PlatformConstant||(t.PlatformConstant={})).IAP_PRODUCT||(m.IAP_PRODUCT={})).NO_IAD="no_iad",m.tournament_solo_play_prompt_interval=36e5,m.tournament_create_interval=36e5;var S=function(e){function i(){var t=e.call(this)||this;return t.http=new h,t.oppenentData=null,t.entry=null,t.switch_gameInfo=null,t.isNewPlayer=!0,t.isFristPlayToday=!1,t.tournament_contextId_created=null,t.entryPointData={},t.playerInfo={id:"1",name:"",photo:"",lang:"",signature:""},t.entryContextInfo={type:"",entry:"",id:""},t._friends=null,t.config=null,t._initialized=!1,t._localData=null,t._remoteData=null,t.bridge={iad_ids:[],rad_ids:[],iad_interval_sec:50,iad_delay_for_new:50,iad_delay_for_old:0,iad_delay_for_old_first_play_today:50,tournament_contextId:""},t._sessionScore=0,setInterval((function(){t._remoteData&&t._remoteData.isDirty&&t.syncRemoteData(),t._localData&&t._localData.isDirty&&t.syncLocalData()}),200),t}return n(i,e),i.prototype.getFriends=function(){return this._friends},i.prototype.initialize=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.config=t,this.config.host_friend||(this.config.host_friend=this.config.host_api),this.config.host_tournament||(this.config.host_tournament=this.config.host_api),[4,this.doInitialize()];case 1:return e.sent(),this._initialized=!0,this.emit("initliazed"),[2]}}))}))},i.prototype.doInitialize=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this._friends=[],this.pullLocalData(),[4,this.pullRemoteData()];case 1:return t.sent(),[2]}}))}))},i.prototype.pullRemoteData=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i;return o(this,(function(o){switch(o.label){case 0:return[4,this.getData(["user_info"])];case 1:t=o.sent(),e={};try{e=JSON.parse(t.user_info)||{}}catch(t){}for(r in this._remoteData=e,this.isNewPlayer=0==Object.keys(e).length,n=new x)null==e[r]&&(e[r]=n[r]);return(i=Date.days())>this._remoteData.login_day_index&&(this._remoteData.login_day_index=i,this._remoteData.login_day_count++,this._remoteData.isDirty=!0,this.isFristPlayToday=!0),[2]}}))}))},i.prototype.syncRemoteData=function(t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return delete this._remoteData.isDirty,[4,this.setData({user_info:JSON.stringify(this._remoteData)},t)];case 1:return e.sent(),[2]}}))}))},Object.defineProperty(i.prototype,"remoteData",{get:function(){return this._remoteData},enumerable:!1,configurable:!0}),i.prototype.pullLocalData=function(){var t={};try{var e=localStorage.getItem("local_user_info_"+this.playerInfo.id);t=JSON.parse(e)||{}}catch(t){}this._localData=t;var n=new D;for(var r in n)null==t[r]&&(t[r]=n[r])},i.prototype.syncLocalData=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return delete this._localData.isDirty,localStorage.setItem("local_user_info_"+this.playerInfo.id,JSON.stringify(this._localData)),[2]}))}))},Object.defineProperty(i.prototype,"localData",{get:function(){return this._localData},enumerable:!1,configurable:!0}),i.prototype.cr=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this._remoteData={},[4,this.syncRemoteData()];case 1:return t.sent(),[2]}}))}))},i.prototype.setLoadingProgress=function(t){},i.prototype.startGame=function(t){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(n){switch(n.label){case 0:return Object.assign(this.bridge,t),this._initialized?[3,2]:[4,new Promise((function(t){return e.once("initliazed",t)}))];case 1:n.sent(),n.label=2;case 2:return[4,this.doStartGame()];case 3:return n.sent(),[2]}}))}))},i.prototype.doStartGame=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,200)}))];case 1:return t.sent(),[2]}}))}))},i.prototype.getAllTimeEntriesAsync=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,[]]}))}))},i.prototype.getAllTimeEntries=function(){return[]},i.prototype.getWeeklyEntriesAsync=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,[]]}))}))},i.prototype.getWeeklyEntries=function(){return[]},i.prototype.getHighScore=function(){return+localStorage.getItem("hight_score1")||0},i.prototype.setHighScore=function(t,e){localStorage.setItem("hight_score1",t+"")},i.prototype.setContextHighScore=function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(e){return localStorage.setItem("hight_score2",t+""),[2]}))}))},i.prototype.getContextHighScore=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,+localStorage.getItem("hight_score2")||0]}))}))},i.prototype.getData=function(t){return r(this,void 0,void 0,(function(){var e,n,r,i;return o(this,(function(o){for(e={},n=0,r=t;n<r.length;n++)i=r[n],e[i]=localStorage.getItem(i);return[2,e]}))}))},i.prototype.setData=function(t,e){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){for(e in t)localStorage.setItem(e,t[e]);return[2]}))}))},i.prototype.hasIAD=function(){return!0},i.prototype.showIAD=function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.hasAD=function(){return!0},i.prototype.showAD=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.hasRAD=function(){return!0},i.prototype.showRAD=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.shareAsync=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2]}))}))},i.prototype.shareLinkAsync=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2]}))}))},i.prototype.inviteAsync=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2]}))}))},i.prototype.updateAsync=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2]}))}))},i.prototype.chooseAsync=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.createAsync=function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.switchAsync=function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.getContextId=function(){return null},i.prototype.getContextType=function(){return null},i.prototype.log=function(t,e,n){console.log(t,JSON.stringify(e))},i.prototype.createShortcutAsync=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.subscribeBotAsync=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.getLocale=function(){return"en_US"},i.prototype.suportIAP=function(){return!1},i.prototype.initPayments=function(t){},i.prototype.purchaseAsync=function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!1]}))}))},i.prototype.getCatalogAsync=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,[]]}))}))},i.prototype.hasPurchased=function(t){return!1},i.prototype.purchaseNoIADAsync=function(){return this.purchaseAsync(t.PlatformConstant.IAP_PRODUCT.NO_IAD)},i.prototype.postSessionScore=function(t,e){void 0===e&&(e=!1),!e&&t<=this._sessionScore||(this._sessionScore=t)},i.prototype.getSessionScore=function(){return this._sessionScore},i.prototype.postSessionScoreAsync=function(t,e){return void 0===e&&(e=!1),r(this,void 0,void 0,(function(){return o(this,(function(n){return this.postSessionScore(t,e),[2,!0]}))}))},i.prototype.switchGameAsync=function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.getPlatformName=function(){return"OTHER"},i.prototype.matchPlayerAsync=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.getCustomData=function(){return this._remoteData.extraData},i.prototype.syncCustomData=function(){this._remoteData.isDirty=!0},i.prototype.getTournamentInfo=function(){return null},i.prototype.resetTournamentCreateCD=function(){this.remoteData.tounament_created_tsp=0,this._remoteData.isDirty=!0},i.prototype.createTournamentAsync=function(t,e,n){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i.prototype.shareTournamentAsync=function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,!0]}))}))},i}(a);function E(t,e){return new Promise((function(n,r){var o=null;o=setTimeout((function(){clearTimeout(o),n(),e&&e()}),t)}))}var P=function(t){function e(e,n){void 0===n&&(n=!0);var r=t.call(this)||this;return r.ids=e,r._adInstance=null,r._isStart=!1,r._watch_count=0,r.suportAD()&&n&&r.preloadAD(),r}return n(e,t),e.prototype.suportAD=function(){throw"should be implemented in subclass!"},e.prototype.getName=function(){throw"should be implemented in subclass!"},e.prototype.getADInstanceAsync=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,null]}))}))},e.prototype.hasAD=function(){return!!this._adInstance},e.prototype.preloadAD=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i,s,a,c,u=this;return o(this,(function(o){switch(o.label){case 0:if(this._isStart)return[2];this._isStart=!0,t="",e=this.ids.concat(),n=0,r=null,o.label=1;case 1:if(r)return[3,24];i=n++%e.length,o.label=2;case 2:return o.trys.push([2,22,,23]),[4,this.getADInstanceAsync(e[i])];case 3:r=o.sent(),t="",console.log(this.getName()+" create suc:"+i),o.label=4;case 4:if(this._adInstance||!r)return[3,21];o.label=5;case 5:return o.trys.push([5,14,,20]),[4,r.loadAsync()];case 6:o.sent(),t="",this._adInstance=r,this.emit("ad_ready"),console.log(this.getName()+" load suc"),o.label=7;case 7:return[4,new Promise((function(t,e){return u.once("show_ad",t)}))];case 8:o.sent(),o.label=9;case 9:return o.trys.push([9,11,,12]),[4,this._adInstance.showAsync()];case 10:return o.sent(),t="",console.log(this.getName()+" show suc"),this.emit("show_result",{result:!0,level:i}),n=0,this._adInstance=null,r=null,[3,13];case 11:return s=o.sent(),console.log(this.getName()+" show failed,"+s.code+","+s.message),this.emit("ad_failed",{type:this.getName(),phase:2,code:s.code,msg:s.message,lastError:t}),t=s.code+":2",this.emit("show_result",{result:!1,err:s,level:i}),"ADS_NOT_LOADED"==s.code?(this._adInstance=null,[3,13]):"PENDING_REQUEST"!=s.code&&"UNKNOWN"!=s.code&&"RATE_LIMITED"!=s.code?(this._adInstance=null,r=null,[3,13]):[3,12];case 12:return[3,7];case 13:return[3,20];case 14:return a=o.sent(),console.log(this.getName()+" load failed,"+a.code+","+a.message),this.emit("ad_failed",{type:this.getName(),phase:1,code:a.code,msg:a.message,lastError:t}),t=a.code+":1","ADS_FREQUENT_LOAD"!=a.code?[3,16]:[4,E(18e5)];case 15:return o.sent(),[3,21];case 16:return"INVALID_PARAM"!=a.code?[3,17]:(r=null,[3,21]);case 17:return[4,E(31e3)];case 18:o.sent(),o.label=19;case 19:return[3,20];case 20:return[3,4];case 21:return[3,23];case 22:return c=o.sent(),console.log(this.getName()+" create failed,"+c.code+","+i),this.emit("ad_failed",{type:this.getName(),phase:0,code:c.code,msg:c.message,lastError:t}),t=c.code+":0","CLIENT_UNSUPPORTED_OPERATION"==c.code||"ADS_TOO_MANY_INSTANCES"==c.code?[2]:[3,23];case 23:return[3,1];case 24:return[2]}}))}))},e.prototype.showAD=function(t){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(n){switch(n.label){case 0:if(!this.hasAD())throw"no ad ready";return this.emit("show_ad")?[4,new Promise((function(n,r){e.once("show_result",(function(r){r.result&&e.emit("ad_show",{type:e.getName(),result:++e._watch_count,level:r.level,source:t}),n(!r.err)}))}))]:[2];case 1:return[2,n.sent()]}}))}))},e}(a),T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getName=function(){return"iad"},e.prototype.suportAD=function(){return FBInstant.getSupportedAPIs().indexOf("getInterstitialAdAsync")>-1},e.prototype.getADInstanceAsync=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,FBInstant.getInterstitialAdAsync(t)];case 1:return[2,e.sent()]}}))}))},e}(P),O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getName=function(){return"rad"},e.prototype.suportAD=function(){return FBInstant.getSupportedAPIs().indexOf("getRewardedVideoAsync")>-1},e.prototype.getADInstanceAsync=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,FBInstant.getRewardedVideoAsync(t)];case 1:return[2,e.sent()]}}))}))},e}(P),B=function(t){function e(e,n,r){void 0===n&&(n="high"),void 0===r&&(r=0);var o=t.call(this)||this;return o.name=e,o.sortType=n,o.defaultScore=r,o._selfEntry=null,o._entries=null,o._friendEntries=null,o._preInitialized=!1,o._preInitializing=!1,o._initialized=!1,o._initializing=!1,o._highScore=0,o._friends=null,o}return n(e,t),e.prototype.preInitializeAsync=function(){return r(this,void 0,void 0,(function(){var t,e,n=this;return o(this,(function(r){switch(r.label){case 0:return this._preInitialized?[2]:this._preInitializing?[4,new Promise((function(t){n.once("preInitialized",t)}))]:[3,2];case 1:return r.sent(),[2];case 2:this._preInitializing=!0,r.label=3;case 3:return r.trys.push([3,6,,7]),t=this,[4,FBInstant.getLeaderboardAsync(this.name)];case 4:return t._leaderboard=r.sent(),[4,this._leaderboard.getPlayerEntryAsync()];case 5:return e=r.sent(),this._selfEntry=e?b.fromLeaderBoardEntry(e):b.fromPlayer(w.fromFBPlayer(FBInstant.player)),this._preInitialized=!0,this._preInitializing=!1,this.emit("preInitialized"),[3,7];case 6:return r.sent(),this._preInitializing=!1,[3,7];case 7:return[2]}}))}))},e.prototype.initializeAsync=function(t,e){return r(this,void 0,void 0,(function(){var n=this;return o(this,(function(r){switch(r.label){case 0:return this._initialized?[2]:this._initializing?[4,new Promise((function(t){n.once("initialized",t)}))]:[3,2];case 1:return r.sent(),[2];case 2:return this._initializing=!0,[4,this.preInitializeAsync()];case 3:r.sent(),r.label=4;case 4:return r.trys.push([4,9,,10]),t?[4,this.getEntriesAsync()]:[3,6];case 5:r.sent(),r.label=6;case 6:return e?[4,this.getConnectedPlayerEntriesAsync()]:[3,8];case 7:r.sent(),r.label=8;case 8:return[3,10];case 9:return r.sent(),console.log("get enties failed!"),[3,10];case 10:return this._initialized=!0,this._initializing=!1,this.emit("initialized"),[2]}}))}))},e.prototype.getEntriesAsync=function(){return r(this,void 0,void 0,(function(){var t,e;return o(this,(function(n){switch(n.label){case 0:return[4,this.preInitializeAsync()];case 1:if(n.sent(),t=this._leaderboard,this._entries||!t)return[3,5];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,t.getEntriesAsync(100,0)];case 3:return e=n.sent(),this._entries=e.map((function(t){return b.fromLeaderBoardEntry(t)})),[3,5];case 4:return n.sent(),console.log("get entries async failed"),this._entries=null,[3,5];case 5:return[2,this._entries||[]]}}))}))},e.prototype.getEntries=function(){return this._entries||[]},e.prototype.getConnectedPlayerEntriesAsync=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i,s;return o(this,(function(o){switch(o.label){case 0:return[4,this.preInitializeAsync()];case 1:if(o.sent(),t=this._leaderboard,this._friendEntries||!t)return[3,5];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,Promise.retry((function(){return t.getConnectedPlayerEntriesAsync(100,0)}),10)];case 3:return e=o.sent(),n=e.length,this._friendEntries=e.map((function(t){return b.fromLeaderBoardEntry(t)})),r=FBInstant.player.getID(),-1==(i=this._friendEntries.findIndex((function(t){return t.id==r})))?(this._friendEntries.push(b.fromPlayer(w.fromFBPlayer(FBInstant.player))),this._friendEntries.forEach((function(t,e){return t.rank=e+1}))):this._selfEntry=this._friendEntries[i],this.bindFriends(),s=this._friendEntries,0==n&&(this._friendEntries=null),[2,s];case 4:return o.sent(),console.log("get friends entries async failed"),this._friendEntries=null,[3,5];case 5:return[2,this._friendEntries||[]]}}))}))},e.prototype.getConnectedPlayerEntries=function(){return this._friendEntries||[]},e.prototype.refreshRankList=function(t,e,n){var r,o=FBInstant.player.getID(),i=t.findIndex((function(t){return t.id==o}));-1!=i?((r=t[i]).score=e,r.extraData=n,t.sorton("score","low"==this.sortType),t.forEach((function(t,e){return t.rank=e+1}))):t.length>0&&e>t[t.length-1].score&&((r=b.fromPlayer(w.fromFBPlayer(FBInstant.player))).score=e,r.extraData=n,t.push(r),t.sorton("score","low"==this.sortType),t.forEach((function(t,e){return t.rank=e+1})))},e.prototype.setScore=function(t,e){var n=this;this._highScore=Math.max(t,this._highScore,0),this._preInitialized?t<this._selfEntry.score||(this._selfEntry.score=t,this._selfEntry.extraData=e,this._entries&&this.refreshRankList(this._entries,t,e),this._friendEntries&&this.refreshRankList(this._friendEntries,t,e),new Promise((function(i,s){return r(n,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this._leaderboard.setScoreAsync(t,JSON.stringify(e))];case 1:return n=o.sent(),this._selfEntry=b.fromLeaderBoardEntry(n),[3,3];case 2:return r=o.sent(),console.log("setScoreAsync failed:",r),[3,3];case 3:return i(),[2]}}))}))})).catch((function(t){console.log("set score error")}))):this.preInitializeAsync().then((function(){n.setScore(t,e)}))},e.prototype.getScore=function(){return this._preInitialized?this._selfEntry.score:this._highScore},e.prototype.setFriends=function(t){this._friends=t,this.bindFriends()},e.prototype.bindFriends=function(){if(this._friends&&this._friendEntries){var t={};this._friends.forEach((function(e){return t[e.id]=e})),t[FBInstant.player.getID()]=w.fromFBPlayer(FBInstant.player);var e=this._friendEntries;for(var n in e.forEach((function(e){var n=t[e.id];n&&(e.name=n.name,e.photo=n.photo,delete t[e.id])})),t){var r=b.fromPlayer(t[n]);r.score=this.defaultScore,e.push(r)}e.sorton("score","low"==this.sortType),e.forEach((function(t,e){return t.rank=e+1}))}},e.prototype.getSelfEntry=function(){return this._selfEntry},e}(a);t.FBInstantEx=void 0,function(t){var e;!function(t){t.on_genericDialog_show="on_genericDialog_show"}(e=t.Event||(t.Event={})),t.fb_require=null,t.sdk_version="unkown",t.tounamentInfoMap={},t.emiter=new a,t.setup=function(){return r(this,void 0,void 0,(function(){var r;return o(this,(function(o){return t.sdk_version=FBInstant.getSDKVersion(),t.fb_require=window.fb_require,t.fb_require?(n=t.fb_require("fbinstant/releases/"+t.sdk_version+"/internalStates.beta").exports,i=n.getMessageSender(),r=i.showGenericDialogAsync,i.showGenericDialogAsync=function(n,o){if(console.log("show dialog:",n,o),"solo_play"!=o.type){var i="expired_tournament"==o.type,s=FBInstant.context.getID(),a=Math.floor(Date.now()/1e3);t.tounamentInfoMap[FBInstant.context.getID()]=new I({contextId:s,endTime:i?a-100:a+172800})}return t.emiter.emit(e.on_genericDialog_show,{name:n,data:o}),r.call(this,n,o)},window.FBInstantEx=t,[2]):[2]}))}))};var n=null,i=null;t.postSessionScoreAsync=function(e){var r=t.fb_require;return r("fbinstant/releases/"+t.sdk_version+"/logger").logAPICall("postSessionScore"),r("fbinstant/common/score").PostSessionScore(i,e,n.getContext().getID()).then((function(e){if(console.log("postSessionScoreAsync",e),e&&e.contextType){var r=n.getContext().getID();n.updateContext(e);var o=n.getContext().getID();if(o!=r){var i=Math.floor(Date.now()/1e3);t.tounamentInfoMap[o]=new I({contextId:o,endTime:i+172800})}}return e}))},t.getTournamentInfoAsync=function(t){return t=t||n.getContext().getID(),i.sendPassThroughAsync("GET_TOURNAMENT_INFO",{contextID:t}).then((function(t){return t&&t.tournament_id&&t.context_id&&t.end_time?{tournamentID:t.tournament_id,contextID:t.context_id,endTime:t.end_time}:null}))},t.getContextSize=function(){return n.getContext().getSize()}}(t.FBInstantEx||(t.FBInstantEx={}));var F,C,k=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._context_leader_board_map={},t.iad_time_interval=3e4,t.iad_timestamp=0,t._chooseAsync_times=0,t._createAsync_times=0,t._switchAsync_times=0,t.matchPlayerAsync_times=0,t._isPaymentsReady=!1,t._tournamentInfo=null,t._cur_contextId=null,t._cur_contextType=null,t}return n(i,e),i.prototype.doInitialize=function(){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(n){switch(n.label){case 0:return[4,FBInstant.initializeAsync().catch((function(t){return console.log("fb init error:",t)}))];case 1:return n.sent(),this.playerInfo.id=FBInstant.player.getID(),this.playerInfo.name=FBInstant.player.getName(),this.playerInfo.photo=FBInstant.player.getPhoto(),this.playerInfo.lang=FBInstant.getLocale(),t.FBInstantEx.setup().catch((function(t){return console.log("ex error:",t)})),this.pullLocalData(),this._leader_board_friend=new A(this.config.host_friend,this.config.game_id),[4,Promise.all([FBInstant.player.getSignedPlayerInfoAsync("kcuf").then((function(t){return e.playerInfo.signature=t.getSignature()})).catch((function(t){return null})),this.pullRemoteData().catch((function(t){return console.log("pull remote failed",t)})),FBInstant.player.getConnectedPlayersAsync().then((function(t){e._friends=t.map((function(t){return w.fromFBPlayer(t)})),e._leader_board_friend.setFriends(t)})).catch((function(){return console.log("get friend error")}))])];case 2:return n.sent(),[2]}}))}))},i.prototype.doStartGame=function(){return r(this,void 0,void 0,(function(){var e,n,r,i,s,a,c,u,l=this;return o(this,(function(o){switch(o.label){case 0:return[4,FBInstant.startGameAsync()];case 1:return o.sent(),e="unknow",[4,Promise.all([this.onContextChange(!0),FBInstant.getEntryPointAsync().then((function(t){return e=t})).catch((function(t){return console.log("faiddd")})),this._leader_board_friend.initializeAsync().catch((function(t){return console.log("leaderboard init failed:",t)}))])];case 2:return o.sent(),this.watchContext(),n=this.getContextType(),this.entryContextInfo.entry=e,this.entryContextInfo.type=n,this.entryContextInfo.id=this.getContextId(),console.log("context_id:",this.entryContextInfo.id),console.log("context_entry:",e),console.log("context_type:",n),console.log("tournament_info:",this._tournamentInfo&&this._tournamentInfo.toString()),"in_game_menu"==this.entryContextInfo.entry&&this.switch_gameInfo&&(console.log("fix entry from in_game_menu to game_switch"),this.entryContextInfo.entry="game_switch"),this.iad_time_interval=1e3*this.bridge.iad_interval_sec,this.isNewPlayer?this.iad_timestamp=Date.now()+1e3*this.bridge.iad_delay_for_new:this.iad_timestamp=this.isFristPlayToday?Date.now()+1e3*this.bridge.iad_delay_for_old_first_play_today:Date.now()+1e3*this.bridge.iad_delay_for_old,r=this.entryPointData=FBInstant.getEntryPointData()||{},(i=r.oppenent_info)&&i.playerId!=this.playerInfo.id&&(this.oppenentData=i),this.entry=r.entry||r.type||"normal","normal"==this.entry&&"admin_message"==e&&(this.entry="leaderboard"),s=FBInstant.getLocale(),this.log("entry_info",{entry:this.entry||"normal",contextType:this.entryContextInfo.type,contextEntry:this.entryContextInfo.entry}),this.isNewPlayer&&this.log("NewEntry",{contextType:this.entryContextInfo.type,contextEntry:this.entryContextInfo.entry,template:this.entry,lang:s}),this.log("ActiveEntry",{contextType:this.entryContextInfo.type,contextEntry:this.entryContextInfo.entry,template:this.entry,lang:s}),this.switch_gameInfo=r.switch_info||r.switchGameInfo||null,this.switch_gameInfo&&this.log("SwitchEntry",{appId:this.switch_gameInfo.appId,appName:this.switch_gameInfo.appName,isNew:this.isNewPlayer?1:0}),this.log("language",{locale:s,lang:s}),(a=this.bridge.iad_ids)&&a.length>0&&!this.hasPurchased(t.PlatformConstant.IAP_PRODUCT.NO_IAD)&&(this._iad=new T(a,!0),this._iad.on("ad_failed",(function(t){return l.log("ad_failed",t)})),this._iad.on("ad_show",(function(t){return l.log("iad_times",t)}))),(c=this.bridge.rad_ids)&&c.length>0&&(this._rad=new O(c,!0),this._rad.on("ad_failed",(function(t){return l.log("ad_failed",t)})),this._rad.on("ad_show",(function(t){return l.log("rad_times",t)}))),this._friends?[3,4]:[4,FBInstant.player.getConnectedPlayersAsync()];case 3:u=o.sent(),this._friends=u.map((function(t){return w.fromFBPlayer(t)})),this._leader_board_friend.setFriends(u),o.label=4;case 4:try{FBInstant.setSessionData({nickname:this.playerInfo.name,playerInfo:{head:this.playerInfo.photo,lang:s,score:this.getHighScore()}})}catch(t){console.log("set session data error:",t)}return console.log("startGame done!"),FBInstant.onPause((function(){console.log("Pause event was triggered!")})),t.FBInstantEx.emiter.on(t.FBInstantEx.Event.on_genericDialog_show,(function(t){if(t&&t.name){var e=t.name;"share_tournament"!=e&&"tournament_status"!=e||t.data&&("solo_play"!=t.data.type&&"thread_play"!=t.data.type||(l.remoteData.tournament_solo_play_prompt=Date.now(),l.remoteData.isDirty=!0),l.log("tournament_dialog",{type:t.data.type}))}})),this.emit("started"),[2]}}))}))},i.prototype.setLoadingProgress=function(t){FBInstant.setLoadingProgress(t)},i.prototype.getAllTimeEntriesAsync=function(){return this._leader_board_friend.getAllTimeEntriesAsync()},i.prototype.getAllTimeEntries=function(){return this._leader_board_friend.getAllTimeEntries()},i.prototype.getWeeklyEntriesAsync=function(){return this._leader_board_friend.getWeeklyEntriesAsync()},i.prototype.getWeeklyEntries=function(){return this._leader_board_friend.getWeeklyEntries()},i.prototype.getHighScore=function(){return this._leader_board_friend.getAllTimeHighScore()},i.prototype.setHighScore=function(t,e){this._leader_board_friend.setScoreAsync(t,e)},i.prototype.getContextLeaderBoard=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return(e=this._context_leader_board_map[t])||(e=new B(this.config.leaderboard_context+"."+t),this._context_leader_board_map[t]=e),[4,e.initializeAsync(!1,!1)];case 1:return n.sent(),[2,e]}}))}))},i.prototype.setContextHighScore=function(t,e){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return n=FBInstant.context.getID(),[4,this.getContextLeaderBoard(n)];case 1:return r.sent().setScore(t,e),[2]}}))}))},i.prototype.getContextHighScore=function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return t=FBInstant.context.getID(),[4,this.getContextLeaderBoard(t)];case 1:return[2,e.sent().getScore()]}}))}))},i.prototype.getData=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,FBInstant.player.getDataAsync(t)];case 1:return[2,e.sent()||{}]}}))}))},i.prototype.setData=function(t,e){return void 0===e&&(e=!1),r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,FBInstant.player.setDataAsync(t)];case 1:return n.sent(),e?[4,FBInstant.player.flushDataAsync()]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},i.prototype.hasAD=function(){return this.hasRAD()},i.prototype.showAD=function(t){return void 0===t&&(t="any"),r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.showRAD(t)];case 1:return[2,e.sent()]}}))}))},i.prototype.hasRAD=function(){return this._rad&&this._rad.hasAD()},i.prototype.showRAD=function(t){return void 0===t&&(t="any"),r(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return this.hasRAD()?(this.log("showRAD",{result:-1,source:t}),(n=this._rad)?[4,this._rad.showAD(t)]:[3,2]):[2,!1];case 1:n=r.sent(),r.label=2;case 2:return e=n,this.log("showRAD",{result:e?1:0,source:t}),this.iad_timestamp=Date.now(),[2,e]}}))}))},i.prototype.hasIAD=function(){return!this.hasPurchased(t.PlatformConstant.IAP_PRODUCT.NO_IAD)&&(this._iad&&this._iad.hasAD())},i.prototype.showIAD=function(t,e){return void 0===t&&(t="any"),void 0===e&&(e=0),r(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:return this.hasIAD()?(n=Date.now())-this.iad_timestamp<this.iad_time_interval?[2,!1]:(this.iad_timestamp=n,e>0?[4,Promise.wait(e)]:[3,2]):[2,!1];case 1:o.sent(),o.label=2;case 2:return this.log("showIAD",{result:-1,source:t}),(i=this._iad)?[4,this._iad.showAD(t)]:[3,4];case 3:i=o.sent(),o.label=4;case 4:return r=i,this.log("showIAD",{result:r?1:0,source:t}),[2,r]}}))}))},i.prototype.shareAsync=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e={entry:t.template||"normal_share"},[4,FBInstant.shareAsync({intent:"SHARE",image:t.image,text:t.text,data:Object.assign(e,t.payload)})];case 1:return n.sent(),this.log("share_async",{template:e.entry}),[2]}}))}))},i.prototype.shareLinkAsync=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e={entry:t.template||"normal_shareLink"},[4,FBInstant.shareLinkAsync({image:t.image,text:t.text,data:Object.assign(e,t.payload)})];case 1:return n.sent(),this.log("shareLink_async",{template:e.entry}),[2]}}))}))},i.prototype.inviteAsync=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e={entry:t.template||"normal_invite"},[4,FBInstant.inviteAsync({image:t.image,text:t.text,data:Object.assign(e,t.payload)})];case 1:return n.sent(),this.log("invite_async",{template:e.entry}),[2]}}))}))},i.prototype.updateAsync=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e={entry:t.template||"normal_update"},[4,FBInstant.updateAsync({action:"CUSTOM",cta:t.cta||"Play now",image:t.image,text:t.text||"Play with me!",template:t.template||"game_result",data:Object.assign(e,t.payload),strategy:t.strategy||"IMMEDIATE_CLEAR",notification:"PUSH"})];case 1:return n.sent(),this.log("update_async",{template:e.entry}),[2]}}))}))},i.prototype.chooseAsync=function(t){return void 0===t&&(t="any"),r(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:e=!1,r.label=1;case 1:return r.trys.push([1,4,,5]),this.log("chooseAsync",{result:-1,source:t}),[4,FBInstant.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"]})];case 2:return r.sent(),this.log("chooseAsync_times",{result:++this._chooseAsync_times,source:t}),[4,this.onContextChange(!0)];case 3:return r.sent(),e=!0,[3,5];case 4:return(n=r.sent())&&"SAME_CONTEXT"==n.code?e=!0:console.log(JSON.stringify(n)),[3,5];case 5:return this.log("chooseAsync",{result:e?1:0,source:t}),[2,e]}}))}))},i.prototype.createAsync=function(t,e){return void 0===e&&(e="any"),r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:n=!1,o.label=1;case 1:return o.trys.push([1,4,,5]),this.log("createAsync",{result:-1,source:e}),[4,FBInstant.context.createAsync(t)];case 2:return o.sent(),this.log("createAsync_times",{result:++this._createAsync_times,source:e}),[4,this.onContextChange(!0)];case 3:return o.sent(),n=!0,[3,5];case 4:return(r=o.sent())&&"SAME_CONTEXT"==r.code?n=!0:console.log(JSON.stringify(r)),[3,5];case 5:return this.log("createAsync",{result:n?1:0,source:e}),[2,n]}}))}))},i.prototype.switchAsync=function(t,e){return void 0===e&&(e="any"),r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:n=!1,o.label=1;case 1:return o.trys.push([1,4,,5]),this.log("switchAsync",{result:-1,source:e}),[4,FBInstant.context.switchAsync(t)];case 2:return o.sent(),this.log("switchAsync_times",{result:++this._switchAsync_times,source:e}),[4,this.onContextChange(!0)];case 3:return o.sent(),n=!0,[3,5];case 4:return(r=o.sent())&&"SAME_CONTEXT"==r.code?n=!0:console.log(JSON.stringify(r)),[3,5];case 5:return this.log("switchAsync",{result:n?1:0,source:e}),[2,n]}}))}))},i.prototype.matchPlayerAsync=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:e=!1,n.label=1;case 1:return n.trys.push([1,4,,5]),this.log("matchPlayerAsync",{result:-1,source:t}),[4,FBInstant.matchPlayerAsync(null,!0,!0)];case 2:return n.sent(),this.log("matchPlayerAsync_times",{result:++this.matchPlayerAsync_times,source:t}),[4,this.onContextChange(!0)];case 3:return n.sent(),e=!0,[3,5];case 4:return n.sent(),console.log("match failed"),[3,5];case 5:return this.log("matchPlayerAsync",{result:1,source:t}),[2,e]}}))}))},i.prototype.log=function(t,n,r){void 0===r&&(r=1),e.prototype.log.call(this,t,n,r),(n=n||{}).nick_name=FBInstant.player.getName(),n.isNew=this.isNewPlayer?"1":"0",FBInstant.logEvent(t,r,n)},i.prototype.createShortcutAsync=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i,s;return o(this,(function(o){switch(o.label){case 0:t=!1,o.label=1;case 1:if(o.trys.push([1,9,,10]),e="short_cut_"+this.config.app_name,n={shortcut:0,shortcut_refuse:0},r=localStorage.getItem(e))try{n=Object.assign(n,JSON.parse(r))}catch(t){console.log("shortcut parse error")}if(0!=n.shortcut)return[2,!1];if(n.shortcut_refuse>=2)return[2,!1];o.label=2;case 2:return o.trys.push([2,7,,8]),[4,FBInstant.canCreateShortcutAsync()];case 3:return o.sent()?(this.log("shortcut",{result:-1}),[4,FBInstant.createShortcutAsync()]):[3,5];case 4:return o.sent(),this.log("shortcut",{result:1}),t=!0,n.shortcut=1,[3,6];case 5:console.log("shortcut unsupport"),o.label=6;case 6:return[3,8];case 7:return i=o.sent(),this.log("shortcut",{result:0,code:i.code}),console.log("shortcut result",JSON.stringify(i)),"USER_INPUT"==i.code?n.shortcut_refuse++:n.shortcut=2,[3,8];case 8:return localStorage.setItem(e,JSON.stringify(n)),[3,10];case 9:return s=o.sent(),console.log("shortcut failed:",s),[3,10];case 10:return[2,t]}}))}))},i.prototype.subscribeBotAsync=function(){return r(this,void 0,void 0,(function(){var t,e;return o(this,(function(n){switch(n.label){case 0:t=!1,n.label=1;case 1:return n.trys.push([1,5,,6]),[4,FBInstant.player.canSubscribeBotAsync()];case 2:return n.sent()?(this.log("bot_subscribe",{result:-1}),[4,FBInstant.player.subscribeBotAsync()]):[3,4];case 3:n.sent(),this.log("bot_subscribe",{result:1}),!0,n.label=4;case 4:return[3,6];case 5:return e=n.sent(),console.log("subscitbe bot failed:",e),this.log("bot_subscribe",{result:0}),[3,6];case 6:return[2,t]}}))}))},i.prototype.suportIAP=function(){return this._isPaymentsReady},i.prototype.initPayments=function(t){var e=this;if(-1!=FBInstant.getSupportedAPIs().indexOf("payments.purchaseAsync")){var n=FBInstant.getPlatform();this.log("iap_ready",{phase:0,platform:n}),FBInstant.payments.onReady((function(){return r(e,void 0,void 0,(function(){var e,r,i,s,a,c;return o(this,(function(o){switch(o.label){case 0:this._isPaymentsReady=!0,this.log("iap_ready",{phase:1,platform:n}),e=[],o.label=1;case 1:return o.trys.push([1,3,,4]),[4,FBInstant.payments.getPurchasesAsync()];case 2:return e=o.sent(),[3,4];case 3:return r=o.sent(),console.log("getPurchasesAsync error:"+r.code||r.message||r),[3,4];case 4:i=0,s=e,o.label=5;case 5:if(!(i<s.length))return[3,10];a=s[i],o.label=6;case 6:return o.trys.push([6,8,,9]),this.log("consume_purchase",{phase:-1,productId:a.productID,platform:n}),[4,FBInstant.payments.consumePurchaseAsync(a.purchaseToken)];case 7:return o.sent(),this.addIAPInventroy(a.productID),t&&t(a.productID),this.log("consume_purchase",{phase:1,productId:a.productID,platform:n}),[3,9];case 8:return c=o.sent(),console.log("consume_purchase error:"+c.code||c.message||c),this.log("consume_purchase",{phase:0,platform:n,code:c.code}),[3,9];case 9:return i++,[3,5];case 10:return[2]}}))}))}))}},i.prototype.getCatalogAsync=function(){return r(this,void 0,void 0,(function(){var t,e;return o(this,(function(n){switch(n.label){case 0:t=null,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,FBInstant.payments.getCatalogAsync()];case 2:return t=n.sent(),console.log(JSON.stringify(t)),[3,4];case 3:return e=n.sent(),console.log("getCatalogAsync error:"+e.code||e.message||e),[3,4];case 4:return[2,t]}}))}))},i.prototype.purchaseAsync=function(t,e){return void 0===e&&(e=""),r(this,void 0,void 0,(function(){var n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:if(!this._isPaymentsReady)return[2,!1];n=!1,r=FBInstant.getPlatform(),this.log("iap",{phase:0,productId:t,platform:r}),o.label=1;case 1:return o.trys.push([1,4,,5]),(i={}).productID=t,e&&(i.developerPayload=i.developerPayload),[4,FBInstant.payments.purchaseAsync(i)];case 2:return s=o.sent(),this.log("iap",{phase:1,productId:t,platform:r}),[4,FBInstant.payments.consumePurchaseAsync(s.purchaseToken)];case 3:return o.sent(),this.addIAPInventroy(s.productID),this.log("iap",{phase:2,productId:t,platform:r}),n=!0,[3,5];case 4:return a=o.sent(),console.log("iap error:"+a.code||a.message||a),this.log("iap",{phase:-1,productId:t,platform:r,code:a.code}),[3,5];case 5:return[2,n]}}))}))},i.prototype.addIAPInventroy=function(t){this.remoteData.iap_inventory.push(t),this.remoteData.isDirty=!0},i.prototype.hasPurchased=function(t){var e=this.remoteData.iap_inventory;return e&&-1!=e.indexOf(t)},i.prototype.postSessionScore=function(t,e){if(void 0===e&&(e=!1),e||!(t<=this._sessionScore))try{FBInstant.postSessionScore(t),this._sessionScore=t,this.persistentTournament(),this.log("session_score",{score:t}),this.emit("session_score_posted",t)}catch(t){console.log("Error",t)}},i.prototype.postSessionScoreAsync=function(e,n){return void 0===n&&(n=!1),r(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:if(r=!1,!n&&e<=this._sessionScore)return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,t.FBInstantEx.postSessionScoreAsync(e)];case 2:return o.sent(),this._sessionScore=e,r=!0,this.log("session_score",{score:e}),this.emit("session_score_posted",e),[3,4];case 3:return i=o.sent(),console.log("session score error",i),[3,4];case 4:return[2,r]}}))}))},i.prototype.switchGameAsync=function(t,e){return r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:n=!1,o.label=1;case 1:return o.trys.push([1,3,,4]),r={switchGameInfo:{appId:this.config.app_id,appName:this.config.app_name},type:this.config.app_name,sourceGame:this.config.app_name},[4,FBInstant.switchGameAsync(t,Object.assign(r,e))];case 2:return o.sent(),n=!0,[3,4];case 3:return o.sent(),console.log("switch err"),[3,4];case 4:return[2,n]}}))}))},i.prototype.getPlatformName=function(){return FBInstant.getPlatform()},i.prototype.getTournamentInfo=function(){return this._tournamentInfo&&this.switch_gameInfo&&FBInstant.context.getID()==this.entryContextInfo.id?null:this._tournamentInfo},i.prototype.persistentContext=function(t){var e=platform.remoteData.context_ids,n=e.indexOf(t);this._tournamentInfo||"THREAD"!=FBInstant.context.getType()?-1!=n&&(e.splice(n,1),platform.remoteData.isDirty=!0):-1==n&&(e.push(t),platform.remoteData.isDirty=!0)},i.prototype.persistentTournament=function(){var t=this;if(this._tournamentInfo&&!this._tournamentInfo.isExpired){var e=this._localData.tournament_map[this._tournamentInfo.contextId]||{endTime:0,score:0};e.endTime=this._tournamentInfo.endTime,e.score=Math.max(this._sessionScore,e.score),this._localData.tournament_map[this._tournamentInfo.contextId]=e,Object.keys(this._localData.tournament_map).forEach((function(e){var n=t._localData.tournament_map[e];Date.now()-1e3*n.endTime>0&&delete t._localData.tournament_map[e]})),this._localData.isDirty=!0}},i.prototype.getContextId=function(){return this._cur_contextId},i.prototype.getContextType=function(){return this._cur_contextType},i.prototype.onContextChange=function(t){return r(this,void 0,void 0,(function(){var t,e,n;return o(this,(function(r){switch(r.label){case 0:this._sessionScore=0,t=FBInstant.context.getID(),this._cur_contextId=t,this._cur_contextType=FBInstant.context.getType(),this._tournamentInfo=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,FBInstant.getTournamentAsync()];case 2:return e=r.sent(),this._tournamentInfo=new I({contextId:e.getContextID(),endTime:e.getEndTime()}),[3,4];case 3:return n=r.sent(),console.log("tournament error:",n),[3,4];case 4:return this.persistentTournament(),this.persistentContext(t),this.emit("context_changed"),[2]}}))}))},i.prototype.watchContext=function(){return r(this,void 0,void 0,(function(){var t,e;return o(this,(function(n){switch(n.label){case 0:return(t=FBInstant.context.getID())==this._cur_contextId?[3,2]:(e=this._cur_contextId,this.tournament_contextId_created=t,this.onTournamentCreated(e),[4,this.onContextChange(!1)]);case 1:n.sent(),this._cur_contextId=t,n.label=2;case 2:return[4,Promise.wait(500)];case 3:return n.sent(),[3,0];case 4:return[2]}}))}))},i.prototype.onTournamentCreated=function(t){console.log("new tournament detected"),this.remoteData.tounament_created_tsp=Date.now(),this.remoteData.isDirty=!0;var e="unknow";e=null==t?"solo":t==this.bridge.tournament_contextId?"end_suggest":"end_auto",console.log("changed to tournament context"),this.log("tournament_create",{source:e})},i.prototype.getLocale=function(){return this.playerInfo.lang},i.prototype.createTournamentAsync=function(t,e,n){return void 0===e&&(e=null),void 0===n&&(n=null),r(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:r=!1,o.label=1;case 1:return o.trys.push([1,3,,4]),this.log("create_tournament",{step:0}),[4,FBInstant.tournament.createAsync({initialScore:t,config:{title:e,image:void 0},data:n})];case 2:return o.sent(),r=!0,[3,4];case 3:return i=o.sent(),console.log("createTournamentAsync failed",i),[3,4];case 4:return this.log("create_tournament",{step:r?1:-1}),[2,r]}}))}))},i.prototype.shareTournamentAsync=function(t,e){return void 0===e&&(e=null),r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:n=!1,o.label=1;case 1:return o.trys.push([1,3,,4]),this.log("tournament_share",{step:0}),[4,FBInstant.tournament.shareAsync({score:t,data:e})];case 2:return o.sent(),n=!0,[3,4];case 3:return r=o.sent(),console.log("shareTournamentAsync failed",r),[3,4];case 4:return this.log("tournament_share",{step:n?1:-1}),[2,n]}}))}))},i}(S),N=function(){function t(){}return t.create=function(){var t;return t=window.FBInstant?new k:new S,Object.defineProperty(window,"platform",{get:function(){return t},configurable:!0}),t},t}();t.ShareBridge=void 0,function(t){var e;function n(t,n,i){return void 0===n&&(n=!0),void 0===i&&(i="normal"),r(this,void 0,void 0,(function(){var r,s,a;return o(this,(function(o){switch(o.label){case 0:return n||e.onBusy(),r={head:platform.playerInfo.photo,playerId:platform.playerInfo.id,name:platform.playerInfo.name,score:t,skin:0},[4,e.onCreateChallengeImg(r,"challenge_request")];case 1:return s=o.sent(),a=r.name+" has challenged you to a match of "+platform.config.app_name+"!",n?(console.log("update"),[4,platform.updateAsync({image:s,text:a,cta:"CHALLENGE",payload:{oppenent_info:r},template:"challenge_request_"+i})]):[3,3];case 2:return o.sent(),console.log("update done"),[3,5];case 3:return[4,platform.shareAsync({image:s,text:a,template:"challenge_request_share_"+i,payload:{oppenent_info:r}})];case 4:o.sent(),o.label=5;case 5:return n||e.onUnbusy(),[2]}}))}))}function i(t,n,i){return void 0===i&&(i=!1),r(this,void 0,void 0,(function(){var r,s,a,c,u;return o(this,(function(o){switch(o.label){case 0:return r={head:platform.playerInfo.photo,playerId:platform.playerInfo.id,name:platform.playerInfo.name,score:t,skin:0},s=i?n.name:"you",a=i?"they":"you",c=r.name+" has challenged "+s+", "+a+" are really evenly matched!",r.score<n.score?c=r.name+" has failed to surpass "+s+", "+s+" win!":r.score>n.score&&(c=r.name+" has succeeded in passing "+s+". Come and surpass "+r.name),[4,e.onCreateChallengeResultImg(r,n,"challenge_result")];case 1:return u=o.sent(),[4,platform.updateAsync({image:u,text:c,cta:"START NEW MATCH",payload:{oppenent_info:r},template:"challenge_result"})];case 2:return o.sent(),[2]}}))}))}t.setup=function(t){e=t},t.normalShare=function(t,n,i){return void 0===n&&(n=!0),void 0===i&&(i={}),r(this,void 0,void 0,(function(){var r,s,a,c,u,l;return o(this,(function(o){switch(o.label){case 0:n||e.onBusy(),o.label=1;case 1:return o.trys.push([1,11,,12]),r={head:platform.playerInfo.photo,playerId:platform.playerInfo.id,name:platform.playerInfo.name,score:platform.getHighScore(),skin:0},s=["Wow! I can't believe I did that.","God, what have I done?"],a=i.payload||{},[4,e.onCreateNormalImg(r,t)];case 2:return c=o.sent(),u=i.text||s.random(),n?[4,platform.updateAsync({text:u,image:c,template:t,cta:"Play",strategy:i.strategy||"IMMEDIATE",payload:a})]:[3,4];case 3:return o.sent(),[3,10];case 4:return"invite"!=i.type?[3,6]:[4,platform.inviteAsync({text:u,image:c,template:t,payload:a})];case 5:return o.sent(),[3,10];case 6:return"shareLink"!=i.type?[3,8]:[4,platform.shareLinkAsync({text:u,image:c,template:t,payload:a})];case 7:return o.sent(),[3,10];case 8:return[4,platform.shareAsync({text:u,image:c,template:t,payload:a})];case 9:o.sent(),o.label=10;case 10:return[3,12];case 11:return l=o.sent(),console.log("normalShare failed",l),[3,12];case 12:return n||e.onUnbusy(),[2]}}))}))},t.championShare=function(t,n,i){return void 0===n&&(n=!0),void 0===i&&(i={}),r(this,void 0,void 0,(function(){var r,s,a,c;return o(this,(function(o){switch(o.label){case 0:return n||e.onBusy(),r={head:platform.playerInfo.photo,playerId:platform.playerInfo.id,name:platform.playerInfo.name,score:platform.getHighScore(),skin:0},s=["Whoa! I can't believe I did that."],[4,e.onCreateChampionImg(r,t)];case 1:return a=o.sent(),c=i.text||s.random(),n?[4,platform.updateAsync({text:c,image:a,template:t,cta:"Play",strategy:i.strategy||"IMMEDIATE"})]:[3,3];case 2:return o.sent(),[3,5];case 3:return[4,platform.shareAsync({text:c,image:a,template:t})];case 4:o.sent(),o.label=5;case 5:return n||e.onUnbusy(),[2]}}))}))},t.challengeShare=n,t.sendScore=function(t,s){return void 0===s&&(s=!1),r(this,void 0,void 0,(function(){var r,a,c,u;return o(this,(function(o){switch(o.label){case 0:return platform.getContextId()&&platform instanceof k?(s&&e.onToast("Sending score..."),r=!0,a=FBInstant.context.isSizeBetween(3,null),(c=a&&a.answer)?[4,FBInstant.context.getPlayersAsync()]:[3,5]):[2,!1];case 1:if(!(o.sent().filter((function(t){return t.getID()!=platform.playerInfo.id})).length>=2))return[3,5];o.label=2;case 2:return o.trys.push([2,4,,5]),platform.setContextHighScore(t),[4,FBInstant.updateAsync({action:"LEADERBOARD",name:platform.config.leaderboard_context+"."+FBInstant.context.getID()})];case 3:return o.sent(),r=!1,[3,5];case 4:return u=o.sent(),console.log("leaderboard error:",u),[3,5];case 5:return r?platform.oppenentData?[4,i(t,platform.oppenentData,c)]:[3,7]:[3,9];case 6:return o.sent(),platform.oppenentData=null,[3,9];case 7:return[4,n(t)];case 8:o.sent(),o.label=9;case 9:return s&&e.onToast("Score sent"),[2,!0]}}))}))}}(t.ShareBridge||(t.ShareBridge={})),t.CommonUSE=void 0,function(e){var n=!0,i=null;e.requestContext=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e=!1),r(this,void 0,void 0,(function(){var r,s,a,c,u;return o(this,(function(o){switch(o.label){case 0:return r=platform.getContextId(),null==i&&(s=platform.remoteData.context_ids.filter((function(t){return t!=r})).map((function(t){return{type:0,id:t}})),platform.getFriends().forEach((function(t){s.push({type:1,id:t.id})})),s.shuffle(),i=s),a=!1,(c=platform.bridge.tournament_contextId)&&c!=r&&!f()||(n=!1),platform.config.super_tournament&&(n=!1),n?(n=!1,t=!1,[4,platform.switchAsync(c,"request_context_tournament")]):[3,2];case 1:if(a=o.sent())return[2,!0];o.label=2;case 2:return t&&i.length>0?0!=(u=i.pop()).type?[3,4]:[4,platform.switchAsync(u.id,"request_context")]:[3,7];case 3:return a=o.sent(),[3,6];case 4:return[4,platform.createAsync(u.id,"request_context")];case 5:a=o.sent(),o.label=6;case 6:if(a)return[2,!0];o.label=7;case 7:return e?[4,platform.matchPlayerAsync("request_context")]:[3,9];case 8:if(a=o.sent())return[2,!0];o.label=9;case 9:return[4,platform.chooseAsync("request_context")];case 10:return[2,a=o.sent()]}}))}))};var s=null,a=null,c=1;function u(t){return r(this,void 0,void 0,(function(){var e,n,r,i,u,l,h,f,p;return o(this,(function(o){switch(o.label){case 0:if(!(e=platform.getContextId()))return[2];if(n=0,r=platform.config.leaderboard_context+"."+e,e==s)return[3,5];console.log("context changed"),a=null,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,FBInstant.getLeaderboardAsync(r)];case 2:return a=o.sent(),s=e,c=1,[3,4];case 3:return i=o.sent(),console.log("rank msg failed:",i),[3,4];case 4:n=1,o.label=5;case 5:if((u=t())>c&&(c=u,n=2),!(n>0&&a))return[3,17];o.label=6;case 6:return o.trys.push([6,16,,17]),console.log("watch:setScoreAsync"),[4,a.setScoreAsync(c,"")];case 7:return l=o.sent(),l.getScore()!=c?[3,9]:(console.log("watch:updateAsync 0"),[4,FBInstant.updateAsync({action:"LEADERBOARD",name:r})]);case 8:return o.sent(),[3,15];case 9:h=platform.playerInfo.name,f=h+" joined this game",c>1&&(f=h+" scored "+u),console.log("watch:updateAsync 1"),o.label=10;case 10:return o.trys.push([10,12,,15]),[4,FBInstant.updateAsync({action:"LEADERBOARD",name:r,text:f})];case 11:return o.sent(),[3,15];case 12:return o.sent(),console.log("watch:updateAsync 2"),[4,Promise.wait(2e3)];case 13:return o.sent(),[4,FBInstant.updateAsync({action:"LEADERBOARD",name:r,text:f})];case 14:return o.sent(),[3,15];case 15:return[3,17];case 16:return p=o.sent(),console.log("watch context failed:",n,p),[3,17];case 17:return[2]}}))}))}e.watchContext=function(t,e){return void 0===e&&(e=4e3),r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:if(!(platform instanceof k))return[2];n.label=1;case 1:return[4,u(t)];case 2:return n.sent(),[4,Promise.wait(e)];case 3:return n.sent(),[3,1];case 4:return[2]}}))}))},e.checkBotAndShortCut=function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,platform.subscribeBotAsync()];case 1:return e.sent(),[4,platform.createShortcutAsync()];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),console.log("bot subscribe/shortcut error",t),[3,4];case 4:return[2]}}))}))},e.reportSwitchGame=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return platform.switch_gameInfo&&platform.isNewPlayer?[4,platform.http.post(platform.config.host_api+"/fbapi/v0/ads/report/"+platform.switch_gameInfo.appId+"/"+platform.config.app_id+"/"+platform.playerInfo.id,{}).catch((function(t){return console.log(t)}))]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.checkSuper=function(){return r(this,void 0,void 0,(function(){var t,e,n;return o(this,(function(r){switch(r.label){case 0:t=platform.config.host_api+"/fbapi/v0/testCase_"+platform.config.game_id,r.label=1;case 1:return r.trys.push([1,3,,4]),n=(e=JSON).parse,[4,platform.http.post(t,{nickname:platform.playerInfo.name,locale:platform.getLocale(),timezoneOffset:(new Date).getTimezoneOffset(),playerId:platform.playerInfo.id,appId:platform.config.app_id})];case 2:return 1==n.apply(e,[r.sent()]).data?[2,!0]:[3,4];case 3:return r.sent(),console.log("check super failed"),[3,4];case 4:return[2,!1]}}))}))},e.reportFriends=function(){return r(this,void 0,void 0,(function(){var t,e;return o(this,(function(n){switch(n.label){case 0:return(t=platform.getFriends()).length>0?(e={action:"friends",playerId:platform.playerInfo.id,payload:t.map((function(t){return t.id}))},[4,platform.http.post(platform.config.host_bot+"/api/v0/upload_"+platform.config.game_id,{data:JSON.stringify(e)}).catch((function(t){return console.log("")}))]):[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))};var l=null;function f(){return Date.now()-platform.remoteData.tounament_created_tsp<t.PlatformConstant.tournament_create_interval}function p(t){return r(this,void 0,void 0,(function(){var n,r,i,s,a,c;return o(this,(function(o){switch(o.label){case 0:if(t<=0)return[2];if(!(n=platform.getTournamentInfo())||n.isExpired)return[2];if(r=e.participated_tournamet_map[n.contextId]||0,t<=r)return console.log("skip  tournament_update_score"),[2];i=null,s="https://fb-api-new.capjoy.com/fbgame/v0/tournament_update_score_"+this.game_id,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._server.post(s,{ctxId:platform.getContextId(),sc:t,pid:platform.playerInfo.id,name:platform.playerInfo.name,photo:platform.playerInfo.photo})];case 2:return a=o.sent(),(i=(i=JSON.parse(a)).data||null)&&i.score>0&&(-1==e.dirty_tournament_ids.indexOf(n.contextId)&&e.dirty_tournament_ids.push(n.contextId),e.participated_tournamet_map[n.contextId]=+i.score||0),[3,4];case 3:return c=o.sent(),console.log("tournament set score failed",c),[3,4];case 4:return[2,i]}}))}))}e.getRecommendGames=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i;return o(this,(function(o){switch(o.label){case 0:if(l)return[2,l];if("IOS"==platform.getPlatformName())return[2,l=[]];t=platform.config.host_api+"/fbapi/v1/getRecommendGames",e={playerId:platform.playerInfo.id,nickname:platform.playerInfo.name,appId:platform.config.app_id,locale:platform.getLocale(),deviceOS:platform.getPlatformName(),timezoneOffset:(new Date).getTimezoneOffset()},o.label=1;case 1:return o.trys.push([1,3,,4]),i=(r=JSON).parse,[4,platform.http.post(t,e)];case 2:return n=i.apply(r,[o.sent()]),l=n.data&&n.data.ads||[],[3,4];case 3:return o.sent(),[3,4];case 4:return[2,l]}}))}))},e.hasTournamentCreatedCD=f,e.participated_tournamet_map={},e.dirty_tournament_ids=[],e.postSessionScoreAsync=p,e.watchPostSessionScore=function(){platform.on("session_score_posted",(function(t){p(t)}))},e.watchTournament=function(){var t=this;console.log("watchTournament ..."),platform.on("context_changed",(function(){return r(t,void 0,void 0,(function(){var t,e,n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return console.log("watchTournament fired..."),(t=platform.getTournamentInfo())?[4,FBInstant.context.getPlayersAsync()]:[2];case 1:e=o.sent(),n=e.length,r={playerId:platform.playerInfo.id,tInfo:{ctx:t.contextId,et:Math.floor(Date.now()/1e3)+172800,ct:n,cid:void 0,cl:void 0,cn:void 0,cp:void 0}},n<=1?(r.tInfo.cid=platform.playerInfo.id,r.tInfo.cn=platform.playerInfo.name,r.tInfo.cp=platform.playerInfo.photo,r.tInfo.cl=platform.playerInfo.lang):2==n&&(i=e.filter((function(t){return t.getID()!=platform.playerInfo.id}))[0])&&(r.tInfo.cid=i.getID(),r.tInfo.cn=i.getName(),r.tInfo.cp=i.getPhoto(),r.tInfo.cl=void 0),r.tInfo=JSON.stringify(r.tInfo),s=platform.config.host_tournament+"/fbgame/v0/tournament_update_"+platform.config.game_id,o.label=2;case 2:return o.trys.push([2,4,,5]),[4,h.getInst().post(s,r)];case 3:return o.sent(),[3,5];case 4:return a=o.sent(),console.log("tournament_update failed",a),[3,5];case 5:return this.postSessionScoreAsync(platform.getSessionScore()),[2]}}))}))}))};var d=null;e.reqTournamentIds=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:if(d)return[3,4];t=platform.config.host_tournament+"/fbgame/v0/tournament_request_"+platform.config.game_id,o.label=1;case 1:return o.trys.push([1,3,,4]),(e=platform.getFriends().map((function(t){return t.id}))).push(platform.playerInfo.id),[4,h.getInst().post(t,{playerId:platform.playerInfo.id,friends:e,locale:platform.playerInfo.lang})];case 2:return n=o.sent(),r=JSON.parse(n),i=r.data&&r.data.tns||[],d=i.map((function(t){return I.fromMSG(t)})),platform.log("friend_tournament_status",{friend_count:e.length,tournament_count:d.length}),d.sort((function(t,e){return e.endTime-t.endTime})),d.length>0&&(console.log("ids:",Object.keys(platform.localData.tournament_map)),s=d.filter((function(t){return!platform.localData.tournament_map[t.contextId]})),console.log("tournaments not participate:",s.length),s.length>0&&(console.log("tournament_contextId changes to:",s[0].contextId),platform.bridge.tournament_contextId=s[0].contextId)),[3,4];case 3:return a=o.sent(),console.log("clean data failed",a),d=[],[3,4];case 4:return[2,d]}}))}))},e.canPlayWithFriend=function(){if(platform.config.super_tournament){var e=platform.getTournamentInfo();return!e||e.isExpired}var n=!1,r=platform.getContextId();if(r){var o=platform.getTournamentInfo();o?o.isExpired?(console.log("is expired"),n=!0):r==platform.tournament_contextId_created?(console.log("equal created"),n=!0):n=!1:n=!0}else platform.getSessionScore()>1?(console.log("has posted session score."),n=!0):Date.now()-platform.remoteData.tournament_solo_play_prompt<t.PlatformConstant.tournament_solo_play_prompt_interval?(console.log("prompt less"),n=!0):Date.now()-platform.remoteData.tounament_created_tsp<t.PlatformConstant.tournament_create_interval?(console.log("create less"),n=!0):n=!1;return n}}(t.CommonUSE||(t.CommonUSE={})),function(){function t(t,e,n){void 0===n&&(n=1);var r=window.FBInstant;null==r||r.logEvent(t,n,e),console.log("[event]",t,JSON.stringify(e))}window.onerror=function(e,n,r,o,i){if("Script error."!=e)return t("crash",{content:[r,o,e].join("-")}),!1},window.addEventListener("unhandledrejection",(function(e){var n=e.reason;"object"==typeof n?n instanceof Error?t("rejection",{content:n.message}):t("rejection",{content:JSON.stringify(n)}):t("rejection",{content:n})}))}(),F=Object.prototype.hasOwnProperty,C=!1,Object.prototype.hasOwnProperty=function(t){if(!window.fb_require&&!C)try{var e=arguments.callee.caller;e&&0==(t+"").indexOf("fbinstant/")&&(Object.prototype.hasOwnProperty=F,window.fb_require=e,console.log("assss"))}catch(t){C=!0,console.log("error:",t)}return F.call(this,t)},function(){var t=null,e=null,n=0,r=0,o=0,i=window.setInterval((function(){if(0==n)(t=window.FBInstant)&&(e=t.setLoadingProgress,t.setLoadingProgress=function(t){o=t+1},n=1);else if(1==n){n=-1;var s=t.initializeAsync.call(t).then((function(){n=2})).catch((function(t){console.log("fb initialized failed:",t),n=1}));t.initializeAsync=function(){return s}}else if(2==n){r<100&&(r+=.25);var a=.9*(r=Math.max(o,r))+.1*o,c=Math.min(100,Math.max(0,~~a));e.call(t,c),c>=99.9&&(n=-2,window.clearInterval(i),console.log("tick stopped"))}}),50)}(),t.BasePlatform=S,t.BasicState=d,t.Color=g,t.DB=v,t.Emiter=a,t.FBPlatform=k,t.Facade=u,t.Flag=_,t.FriendLeaderboard=A,t.Http=h,t.LeaderBoard=B,t.LocalData=D,t.Model=l,t.PlatformFactory=N,t.PlayerVO=w,t.Pool=c,t.RankVO=b,t.RemoteData=x,t.StateMachine=p,t.Storager=f,t.Tournament=I,t.Updater=y,Object.defineProperty(t,"__esModule",{value:!0})})),console.log("ig_core:2.0.111");
